<!DOCTYPE html>
<html>
<head>
  <title>Supabase Users</title>
</head>
<body>
  <h3>Tambah Data</h3>
  <form id="userForm">
    <input type="text" id="address" placeholder="Alamat" required>
    <button id="insertBtn" type="submit">Tambah</button>
  </form>

  <h3>Daftar Alamat:</h3>
  <select id="userSelect">
    <option disabled selected>Loading...</option>
  </select>

  <script>
    const API_URL = "https://ymbtbodeofdcgnsgxzzg.supabase.co/rest/v1/users";
    const API_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltYnRib2Rlb2ZkY2duc2d4enpnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzIzMTA1MywiZXhwIjoyMDY4ODA3MDUzfQ.ejm_bGvGVWMrpaTsjJKS2EspWffmgHjmQscLuyDlfDI";

    // Ambil semua data dan isi ke select
    function loadUsers() {
      fetch(API_URL + "?select=*", {
        headers: {
          "apikey": API_KEY,
          "Authorization": "Bearer " + API_KEY
        }
      })
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById("userSelect");
        select.innerHTML = ""; // Kosongkan dulu
        data.forEach(user => {
          const option = document.createElement("option");
          option.value = user.id || user.address; // fallback
          option.textContent = user.address || "Tanpa alamat";
          select.appendChild(option);
        });
      })
      .catch(err => {
        alert("Gagal ambil data: " + err.message);
      });
    }

  // Benar: tangani submit dari form, bukan tombol
document.getElementById("userForm").addEventListener("submit", function (e) {
  e.preventDefault(); // cegah reload halaman
  const address = document.getElementById("address").value;

  fetch(API_URL, {
    method: "POST",
    headers: {
      "apikey": API_KEY,
      "Authorization": "Bearer " + API_KEY,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ address })
  })
  .then(response => {
    if (response.ok) {
      alert("Data berhasil ditambahkan!");
      document.getElementById("address").value = ""; // kosongkan input
      loadUsers(); // refresh isi select
    } else {
      return response.text().then(text => { throw new Error(text); });
    }
  })
  .catch(error => {
    alert("Gagal menambahkan data: " + error.message);
  });
});

    // Muat semua data saat halaman dibuka
    loadUsers();
  </script>
</body>
</html>

